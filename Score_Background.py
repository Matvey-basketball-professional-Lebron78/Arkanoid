# ============================================================================
# ИМПОРТ БИБЛИОТЕК (Подключение внешних модулей)
# ============================================================================

import pygame  # Основная библиотека для создания игр (обработка графики, событий)
import sys     # Системный модуль для управления программой (выход, аргументы)
import os      # Модуль для работы с файловой системой (пути, проверка файлов)


# ============================================================================
# ИНИЦИАЛИЗАЦИЯ PYGAME
# ============================================================================

# pygame.init() - это обязательная функция, которую нужно вызвать ДО использования pygame
# Она инициализирует все модули pygame (видео, звук, шрифты и т.д.)
#pygame.init()


# ============================================================================
# СОЗДАНИЕ И НАСТРОЙКА ИГРОВОГО ОКНА
# ============================================================================

# Переменные для размеров окна
screen_width = 1280    # Ширина окна в пикселях
screen_height = 800    # Высота окна в пикселях

# pygame.display.set_mode() создает окно с заданными размерами
# Возвращает поверхность (Surface) на которой мы будем рисовать
#screen = pygame.display.set_mode((screen_width, screen_height))

# Устанавливает заголовок окна (текст в верхней полоске окна)
#pygame.display.set_caption("Арканоид - Фон и Счет")

# pygame.time.Clock() создает объект для контроля скорости выполнения программы
# Помогает ограничить FPS (кадры в секунду)
#clock = pygame.time.Clock()


# ============================================================================
# ФУНКЦИЯ 1: load_background(image_path)
# ============================================================================
# НАЗНАЧЕНИЕ: Загружает фоновое изображение и подгоняет его под размер окна
# ПАРАМЕТР: image_path - путь к файлу с фоновым изображением (по умолчанию 'images/background/-1.png')
# ВОЗВРАЩАЕТ: Изображение размером 1280x800 или черный фон если ошибка
# ============================================================================

def load_background(image_path='images/background/-1.png'):
    
    # TRY-EXCEPT конструкция - механизм обработки ошибок в Python
    # try:     - пытаемся выполнить блок кода
    # except:  - если произойдет ошибка, выполняем этот блок вместо краша
    # Это позволяет программе продолжать работу даже при ошибке
    
    try:
        # Загружаем изображение с диска в памяць
        image = pygame.image.load(image_path)
        
        # Конвертируем изображение в формат видеокарты для лучшей производительности
        # Это ускоряет отрисовку
        image = image.convert()
        
        # Масштабируем (меняем размер) изображения ровно на размер окна
        # (screen_width, screen_height) = (1280, 800)
        return pygame.transform.scale(image, (screen_width, screen_height))
    
    except:  # Если произошла ошибка (файл не найден, неправильный формат и т.д.)
        # Создаем пустую черную поверхность
        bg = pygame.Surface((screen_width, screen_height))
        
        # Заполняем её черным цветом
        # RGB (0, 0, 0) = черный цвет
        bg.fill((0, 0, 0))
        
        # Возвращаем черный фон вместо изображения
        return bg


# ============================================================================
# ФУНКЦИЯ 2: load_digit_images(folder, width, height)
# ============================================================================
# НАЗНАЧЕНИЕ: Загружает все 10 цифр (0-9) из папки и создает их заглушки если их нет
# ПАРАМЕТРЫ:
#   - folder: путь к папке с цифрами (по умолчанию 'images/digits')
#   - width: ширина каждой цифры в пикселях (по умолчанию 80)
#   - height: высота каждой цифры в пикселях (по умолчанию 80)
# ВОЗВРАЩАЕТ: Словарь (dictionary) где ключ = цифра, значение = изображение
#   Пример: {"0": image, "1": image, "2": image, ..., "9": image}
# ============================================================================

def load_digit_images(folder="images/digits", width=80, height=80):
    
    # Создаем пустой словарь - это как пустой шкаф для хранения цифр
    images = {}
    
    # for i in range(10) - цикл который повторится 10 раз (i = 0, 1, 2, ..., 9)
    # Это значит для каждой цифры от 0 до 9
    for i in range(10):
        
        # os.path.join() - правильно составляет путь к файлу
        # Например: folder = "images/digits", i = 0
        # file_path становится: "images/digits/0.png"
        # Это работает на любой системе (Windows, Mac, Linux)
        file_path = os.path.join(folder, f"{i}.png")
        # Примечание: f"{i}.png" называется f-string (formatted string)
        # Это способ вставить переменную в строку
        
        # os.path.exists() проверяет, существует ли файл на диске
        if os.path.exists(file_path):
            
            # Файл найден - пытаемся его загрузить
            try:
                # pygame.image.load() загружает изображение с диска
                img = pygame.image.load(file_path)
                
                # pygame.transform.scale() меняет размер изображения
                # Масштабируем цифру до размера (width, height) = (80, 80)
                # str(i) преобразует число в строку (0 -> "0", 1 -> "1" и т.д.)
                # Это нужно потому что словарь использует строки как ключи
                images[str(i)] = pygame.transform.scale(img, (width, height))
            
            except:  # Если ошибка при загрузке файла
                # Вызываем функцию create_digit_placeholder() чтобы создать заглушку
                images[str(i)] = create_digit_placeholder(i, width, height)
        
        else:  # Если файл не существует вообще
            # Сразу создаем заглушку (временное изображение цифры с текстом)
            images[str(i)] = create_digit_placeholder(i, width, height)
    
    # Возвращаем готовый словарь со всеми цифрами
    return images


# ============================================================================
# ФУНКЦИЯ 3: create_digit_placeholder(digit, width, height)
# ============================================================================
# НАЗНАЧЕНИЕ: Создает временное изображение цифры если реальной картинки нет
# ПАРАМЕТРЫ:
#   - digit: какую цифру рисовать (0-9)
#   - width: ширина в пикселях
#   - height: высота в пикселях
# ВОЗВРАЩАЕТ: Изображение (Surface) с цифрой написанной текстом
# ============================================================================

def create_digit_placeholder(digit, width, height):
    
    # pygame.Surface() создает новую пустую поверхность для рисования
    # (width, height) = размеры этой поверхности
    surf = pygame.Surface((width, height))
    
    # .fill() заполняет поверхность одним цветом
    # (100, 100, 100) = серый цвет в RGB формате
    # RGB = Red, Green, Blue (значения от 0 до 255)
    surf.fill((100, 100, 100))
    
    # pygame.font.SysFont() создает системный шрифт
    # None = использовать стандартный шрифт
    # 60 = размер шрифта
    font = pygame.font.SysFont(None, 60)
    
    # .render() рисует текст
    # str(digit) = преобразуем цифру в строку ("0", "1" и т.д.)
    # True = использовать антиалиасинг (сглаживание краев для красоты)
    # (255, 255, 255) = белый цвет
    text = font.render(str(digit), True, (255, 255, 255))
    
    # .get_rect() получает прямоугольник вокруг текста
    # center=(width//2, height//2) = центрируем текст в середине
    # // это целочисленное деление (1280 // 2 = 640)
    text_rect = text.get_rect(center=(width//2, height//2))
    
    # .blit() рисует один объект поверх другого
    # surf - это поверхность на которой рисуем
    # text - это текст который рисуем
    # text_rect - это позиция где рисовать
    surf.blit(text, text_rect)
    
    # Возвращаем готовое изображение цифры
    return surf


# ============================================================================
# ФУНКЦИЯ 4: draw_score(surface, score, images, x, y, spacing, digits)
# ============================================================================
# НАЗНАЧЕНИЕ: Рисует на экране счет используя отдельные изображения цифр
# ПАРАМЕТРЫ:
#   - surface: экран на котором рисовать (переменная screen)
#   - score: число которое нужно нарисовать (например 1234)
#   - images: словарь со всеми цифрами
#   - x: X координата (где начинать слева)
#   - y: Y координата (где начинать сверху)
#   - spacing: расстояние между цифрами в пикселях (по умолчанию 5)
#   - digits: сколько цифр показывать, добавляя нули впереди (по умолчанию 6)
# ВОЗВРАЩАЕТ: Ничего (просто рисует на экране)
# ============================================================================

def draw_score(surface, score, images, x, y, spacing=5, digits=6):
    
    # Проверяем, загрузились ли цифры
    # if not images значит "если словарь пустой"
    if not images:
        return  # Выходим из функции, если нечего рисовать
    
    # .zfill() добавляет нули в начало строки
    # Пример: str(5).zfill(6) = "000005"
    # Это нужно чтобы всегда показывать одно количество цифр
    score_str = str(score).zfill(digits)
    
    # Определяем ширину одной цифры
    if "0" in images:
        # Если цифра 0 загружена - берем её ширину
        digit_width = images["0"].get_width()
    else:
        # Если почему-то нет цифры 0 - используем 80 как стандарт
        digit_width = 80
    
    # enumerate() - это функция которая дает номер И значение одновременно
    # for i, digit in enumerate(score_str):
    # Пример: score_str = "000005"
    # i=0, digit='0'
    # i=1, digit='0'
    # i=2, digit='0'
    # i=3, digit='0'
    # i=4, digit='0'
    # i=5, digit='5'
    for i, digit in enumerate(score_str):
        
        # Проверяем, есть ли изображение для этой цифры
        if digit in images:
            
            # Берем изображение цифры из словаря
            img = images[digit]
            
            # Вычисляем X позицию для каждой цифры
            # Каждая следующая цифра смещается вправо на (digit_width + spacing)
            # Пример: для первой цифры (i=0): x_pos = 920 + 0 * 85 = 920
            #         для второй цифры (i=1): x_pos = 920 + 1 * 85 = 1005
            #         для третьей цифры (i=2): x_pos = 920 + 2 * 85 = 1090
            x_pos = x + i * (digit_width + spacing)
            
            # .blit() рисует изображение на экран
            # surface - это экран (переменная screen)
            # img - это изображение цифры
            # (x_pos, y) - координаты где рисовать
            surface.blit(img, (x_pos, y))


# ============================================================================
# ЗАГРУЗКА РЕСУРСОВ В ПАМЯТЬ
# ============================================================================

# Загружаем фоновое изображение (или черный фон если файла нет)
#background = load_background('images/background/-1.png')

# Загружаем все 10 цифр (0-9) размером 80x80 пикселей
digit_images = load_digit_images("images/digits", 80, 80)


# ============================================================================
# ПЕРЕМЕННЫЕ ИГРЫ (Начальные значения)
# ============================================================================

current_score = 0      # Текущий счет (в начале 0)
display_x = 920        # X координата где показывать счет на экране (слева = 0, справа = 1280)
display_y = 157        # Y координата где показывать счет (сверху = 0, снизу = 800)
digit_spacing = 0      # Расстояние между цифрами (0 = цифры рядом, 5 = с промежутком)
num_digits = 4         # Сколько цифр показывать (4 = 0001, 0042, 0999 и т.д.)


# ============================================================================
# ГЛАВНЫЙ ИГРОВОЙ ЦИКЛ
# ============================================================================

# running - это флаг (переменная которая может быть True или False)
# Цикл while выполняется пока running = True
#running = True

#while running:
    # Обрабатываем события (события = нажатия клавиш, закрытие окна и т.д.)
    # pygame.event.get() возвращает список всех событий которые произошли
    #for event in pygame.event.get():
        
        # Проверяем, закрыл ли пользователь окно (нажал крестик)
        # pygame.QUIT - это константа которая означает "закрытие окна"
        #if event.type == pygame.QUIT:
            #running = False  # Устанавливаем флаг в False, цикл завершится
    
    # ===== ОТРИСОВКА (РИСУЕМ НА ЭКРАНЕ) =====
    
    # Рисуем фоновое изображение на экран
    # screen - это наше окно
    # background - это загруженный фон
    # (0, 0) - это левый верхний угол экрана
    # .blit() = нарисовать
    #screen.blit(background, (0, 0))
    
    # Рисуем счет на экран
    # Передаем все необходимые параметры в функцию
    #draw_score(screen, current_score, digit_images, 
               #display_x, display_y, digit_spacing, num_digits)
    
    # pygame.display.flip() обновляет весь экран
    # Без этой команды мы рисуем в памяти, но ничего не видим на мониторе
    # flip() показывает всё нарисованное
    #pygame.display.flip()
    
    # clock.tick(60) ограничивает скорость до 60 FPS (кадров в секунду)
    # Это значит максимум 60 раз в секунду выполнится этот цикл
    # Без этого программа может работать слишком быстро
    #clock.tick(60)


# ============================================================================
# ЗАВЕРШЕНИЕ ПРОГРАММЫ
# ============================================================================

# pygame.quit() закрывает PyGame и освобождает ресурсы
# Это нужно делать перед выходом

#pygame.quit()

# sys.exit() завершает работу программы
# Программа полностью закрывается

#sys.exit()
